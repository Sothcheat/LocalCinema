<Page
    x:Class="LocalCinema.Views.LibraryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:LocalCinema.Controls"
    xmlns:converters="using:LocalCinema.Converters"
    mc:Ignorable="d"
    Background="{StaticResource BackgroundBrush}">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
    </Page.Resources>

    <Grid>
        <!-- Main Content -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Top Bar -->
            <Grid Grid.Row="0" Padding="40,30,40,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Title -->
                <TextBlock 
                    Grid.Column="0"
                    Text="LocalCinema" 
                    FontSize="32" 
                    FontWeight="Bold"
                    Foreground="{StaticResource TextPrimaryBrush}"
                    VerticalAlignment="Center"/>

                <!-- Search Box -->
                <AutoSuggestBox
                    Grid.Column="1"
                    PlaceholderText="Search movies..."
                    Text="{x:Bind ViewModel.SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Width="400"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Margin="40,0"/>

                <!-- Sort Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="12">
                    <Button Content="A-Z" Command="{x:Bind ViewModel.SortByTitleCommand}" 
                            Style="{StaticResource PrimaryButtonStyle}"/>
                    <Button Content="Year" Command="{x:Bind ViewModel.SortByYearCommand}"
                            Style="{StaticResource PrimaryButtonStyle}"/>
                </StackPanel>
            </Grid>

            <!-- Movie Grid -->
            <ScrollViewer Grid.Row="1" Padding="40,20">
                <GridView
                    ItemsSource="{x:Bind ViewModel.Movies, Mode=OneWay}"
                    SelectionMode="None"
                    IsItemClickEnabled="True"
                    ItemClick="MovieGrid_ItemClick">

                    <GridView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <ItemsWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="6"/>
                        </ItemsPanelTemplate>
                    </GridView.ItemsPanel>

                    <GridView.ItemTemplate>
                        <DataTemplate x:DataType="models:Movie" xmlns:models="using:LocalCinema.Models">
                            <controls:MovieCard Movie="{x:Bind}"/>
                        </DataTemplate>
                    </GridView.ItemTemplate>
                </GridView>
            </ScrollViewer>

            <!-- Loading Indicator -->
            <ProgressRing 
                Grid.Row="1"
                IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibility}}"
                Width="60" 
                Height="60"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"/>
        </Grid>

        <!-- Movie Details Overlay (Updated with TMDb data) -->
        <Grid x:Name="DetailsOverlay" 
              Visibility="Collapsed"
              Background="#CC000000">
            <Border 
                Background="{StaticResource SurfaceBrush}"
                CornerRadius="12"
                MaxWidth="900"
                MaxHeight="700"
                Padding="0">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="300"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Backdrop Image -->
                    <Grid Grid.Row="0">
                        <Image 
                            x:Name="DetailBackdrop"
                            Stretch="UniformToFill"
                            Opacity="0.6"/>
                        <Border Background="Black" Opacity="0.3"/>

                        <!-- Close Button -->
                        <Button 
                            Content="✕"
                            Click="CloseDetails_Click"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Margin="20"
                            Background="#AA000000"
                            Foreground="White"
                            FontSize="20"
                            Width="40"
                            Height="40"/>
                    </Grid>

                    <!-- Movie Details Content -->
                    <ScrollViewer Grid.Row="1" Padding="40">
                        <StackPanel Spacing="16">
                            <!-- Title and Year -->
                            <TextBlock 
                                x:Name="DetailTitle"
                                FontSize="36" 
                                FontWeight="Bold"
                                Foreground="{StaticResource TextPrimaryBrush}"
                                TextWrapping="Wrap"/>

                            <StackPanel Orientation="Horizontal" Spacing="16">
                                <TextBlock 
                                    x:Name="DetailYear"
                                    FontSize="18"
                                    Foreground="{StaticResource TextSecondaryBrush}"/>

                                <TextBlock 
                                    Text="•"
                                    FontSize="18"
                                    Foreground="{StaticResource TextSecondaryBrush}"/>

                                <TextBlock 
                                    x:Name="DetailRuntime"
                                    FontSize="18"
                                    Foreground="{StaticResource TextSecondaryBrush}"/>

                                <TextBlock 
                                    Text="•"
                                    FontSize="18"
                                    Foreground="{StaticResource TextSecondaryBrush}"/>

                                <TextBlock 
                                    x:Name="DetailRating"
                                    FontSize="18"
                                    Foreground="#FFFFD700"/>
                            </StackPanel>

                            <!-- Genre -->
                            <TextBlock 
                                x:Name="DetailGenre"
                                FontSize="16"
                                FontWeight="SemiBold"
                                Foreground="{StaticResource AccentBrush}"/>

                            <!-- Description -->
                            <TextBlock 
                                x:Name="DetailDescription"
                                TextWrapping="Wrap"
                                FontSize="15"
                                LineHeight="24"
                                Foreground="{StaticResource TextSecondaryBrush}"
                                Margin="0,8,0,0"/>

                            <!-- Cast -->
                            <StackPanel Spacing="8" Margin="0,16,0,0">
                                <TextBlock 
                                    Text="Cast"
                                    FontSize="18"
                                    FontWeight="SemiBold"
                                    Foreground="{StaticResource TextPrimaryBrush}"/>
                                <TextBlock 
                                    x:Name="DetailCast"
                                    FontSize="14"
                                    TextWrapping="Wrap"
                                    Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>

                            <!-- Play Button -->
                            <Button 
                                Content="▶ Play Movie"
                                Click="PlayMovie_Click"
                                Style="{StaticResource PrimaryButtonStyle}"
                                HorizontalAlignment="Left"
                                Margin="0,24,0,0"
                                FontSize="18"
                                Padding="40,16"/>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- Video Player Overlay (Same as before) -->
        <Grid x:Name="PlayerOverlay" 
              Visibility="Collapsed"
              Background="Black">

            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Video Container -->
            <Border x:Name="VideoContainer" Grid.Row="0"/>

            <!-- Media Controls -->
            <Grid Grid.Row="1" 
                  Background="#33000000" 
                  Padding="30,20">

                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Progress Slider -->
                <Slider 
                    x:Name="ProgressSlider"
                    Grid.Row="0"
                    Margin="0,0,0,20"
                    ValueChanged="ProgressSlider_ValueChanged"/>

                <!-- Control Buttons -->
                <StackPanel Grid.Row="1" 
                           Orientation="Horizontal" 
                           HorizontalAlignment="Center"
                           Spacing="20">

                    <Button Content="⏮ 10s" Click="SkipBackward_Click" 
                            Style="{StaticResource PrimaryButtonStyle}"/>

                    <Button x:Name="PlayPauseButton" 
                            Content="▶" 
                            Click="PlayPause_Click"
                            Style="{StaticResource PrimaryButtonStyle}"
                            Width="80"/>

                    <Button Content="10s ⏭" Click="SkipForward_Click"
                            Style="{StaticResource PrimaryButtonStyle}"/>

                    <Button Content="✕ Close" Click="ClosePlayer_Click"
                            Style="{StaticResource PrimaryButtonStyle}"/>
                </StackPanel>

                <!-- Time Display -->
                <TextBlock 
                    x:Name="TimeDisplay"
                    Grid.Row="1"
                    Text="00:00 / 00:00"
                    Foreground="White"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    FontSize="14"/>
            </Grid>
        </Grid>
    </Grid>
</Page>